#!/bin/sh

usage() {
    echo "Usage: $0 master <master_ip>"
    echo "       $0 agent  <master_ip> <authz_code>"
    echo "       $0 slave  <master_ip> <authz_code>"
}

XDPREFIX=/opt/xbaydns
BIND_CHROOT=${XDPREFIX}/named
export XDPREFIX BIND_CHROOT

if [ $# -lt 2 ]; then
    usage
    exit 1
else
    TYPE=$1
    MASTERIP=$2
    if [ $TYPE = "master" ]; then
        ${XDPREFIX}/bin/xdmaster $MASTERIP $BIND_CHROOT
    elif [ $TYPE = "agent" ]; then
        AUTHZCODE=$3 
        ${XDPREFIX}/bin/xdagent $MASTERIP $AUTHZCODE
    elif [ $TYPE = "slave" ]; then
        if [ $# -lt 3 ]; then
            usage
            exit 1
        fi
        AUTHZCODE=$3
        ${XDPREFIX}/bin/xdslave $MASTERIP $AUTHZCODE $BIND_CHROOT
    else
        usage
        exit 1
    fi
fi
